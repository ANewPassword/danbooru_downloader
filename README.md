## 它可以做什么

此脚本可通过[yande.re](https://yande.re/)公开 API 获取帖子列表以多线程的方式批量下载图片，可选择根据`页面ID`/`图片ID`区间下载两种下载模式，另支持自定义设置`每页帖子数量`、`搜索/排除的标签`、`线程数`、`文件保存路径`、`http代理`。

脚本可自动判断图片文件是否已存在，避免重复下载消耗流量。

---

## 使用方法

### 运行方式

使用**shell**运行，仅测试了在`Windows 10 + PowerShell + Python 3.9.1 64-bit`环境下可以正常运行。

### 参数

| 参数名 | 短写参数名 | 类型 |    默认值    |                                                              描述                                                               |
| :----: | :--------: | :--: | :----------: | :-----------------------------------------------------------------------------------------------------------------------------: |
|  mode  |     m      | 必选 |      无      | 指定运行模式，取值范围：`["id", "page", "update", "copyright"]`，`id`：通过 ID 下载 / `page`：通过页码下载 / `update`：更新脚本 |
| start  |     s      | 可选 |    (int)1    |                                                             开始 ID                                                             |
|  end   |     e      | 可选 |    (int)1    |                                        结束 ID，`-1` 表示下载到最新一张图/下载到最后一页                                        |
| limit  |     l      | 可选 |  (int)1000   |                                              每页的图片数量，取值范围：`1 - 1000`                                               |
|  tags  |     t      | 可选 |   (str)""    |                                 搜索(`tagname`)/排除(`-tagname`)指定 tags，使用`+`连接多个 tag                                  |
| thread |     T      | 可选 |    (int)5    |                                    线程数，建议设置为 `5` 或更低，过高可能造成 HTTP429 错误                                     |
|  path  |     p      | 可选 | (str)"./img" |                                                          文件保存路径                                                           |
| proxy  |     P      | 可选 |   (str)""    |                                        http 代理地址，格式：`协议://用户名:密码@IP:端口`                                        |

### 示例

#### `id`模式

**yande.re 的 post id 会递增：post id 越大，帖子上传时间越晚，最新帖子的 post id 永远大于其他 post id。**

##### 示例一

```shell
python3 main.py -m id -s 301 -e 301
```

含义：根据`图片ID`下载，从`301`下载到`301`（仅下载 ID 为`301`的图片）。

##### 示例二

```shell
python3 main.py -m id -s 123456 -e 654321
```

含义：根据`图片ID`下载，从`123456`下载到`654321`（下载 ID 在`[123456,654321]`区间中的图片，实际下载时会倒序下载，即从 654321 开始下载）。

##### 示例三

```shell
python3 main.py -m id -s 123456 -e -1
```

含义：根据`图片ID`下载，从`123456`下载到`最新一张图`（下载 ID 大于等于`123456`的图片，实际下载时会倒序下载，即从最新一张图开始下载）。

##### 示例四

```shell
python3 main.py -m id -s 1 -e -1
```

含义：根据`图片ID`下载，从`1`下载到`最新一张图`（下载 ID 大于等于`1`的图片，即`全部下载`，实际下载时会倒序下载，即从最新一张图开始下载）。

#### `page`模式

**yande.re 的 page id 会动态更新：page id 越大，帖子上传时间越早，最新帖子所在的 page id 永远为 1。**

##### 示例五

```shell
python3 main.py -m page -s 301 -e 301
```

含义：根据`页面ID`下载，从`301`下载到`301`（仅下载第`301`页的图片）。

##### 示例六

```shell
python3 main.py -m page -s 123 -e 456
```

含义：根据`页面ID`下载，从`123`下载到`456`（下载所在位置在`[123,456]`区间页中的图片）。

##### 示例七

```shell
python3 main.py -m page -s 123 -e -1
```

含义：根据`页面ID`下载，从`123`下载到`最后一页`（下载所在位置大于等于第`123`页中的图片）。

##### 示例八

```shell
python3 main.py -m page -s 1 -e -1
```

含义：根据`页面ID`下载，从`1`下载到`最后一页`（下载所在位置大于等于第`1`页的图片，即`全部下载`）。

#### `update`模式

##### 示例九

```shell
python3 main.py -m update
```

含义：更新脚本。

##### 示例十

```shell
python3 main.py -m update -p "./downloader" -P "http://username:password@127.0.0.1:8080"
```

含义：更新脚本，日志保存到当前目录下名为`downloader`的目录（如不存在则自动创建），使用 HTTP 代理：`http://username:password@127.0.0.1:8080`。

#### 其他参数

##### 示例十一

```shell
python3 main.py -m page -s 1 -e -1 -l 100 -t "angel+-tagme+tail+-ass" -T 4 -p "./downloader" -P "http://username:password@127.0.0.1:8080"
```

也可以选择不使用短写参数：

```shell
python3 main.py --mode page --start 1 --end -1 --limit 100 --tags "angel+-tagme+tail+-ass" --thread 4 --path "./downloader" --proxy "http://username:password@127.0.0.1:8080"
```

含义：根据`页面ID`下载，下载所在位置大于等于第`1`页的图片（即`全部下载`），每次获取`100`个帖子（图片），只获取标签中包含`["angel", "tail"]`且不包含`["tagme", "ass"]`的帖子，`4`线程下载，下载到当前目录下名为`downloader`的目录（如不存在则自动创建），使用 HTTP 代理：`http://username:password@127.0.0.1:8080`。

##### 示例十二

```shell
python3 main.py -m id
python3 main.py -m page
```

含义：当只指定下载模式时，其他参数将均使用**默认值**，即：开始 ID 与结束 ID 均为`1`，每次获取`1000`个帖子（图片），不指定/排除标签，`5`线程下载，下载到当前目录下名为`img`的目录（如不存在则自动创建），不使用 HTTP 代理。

---

## 更新日志

### V1.2.5

1. 美化代码，更换更新接口。

### V1.2.0

1. 修改了通过图片ID区间下载时获取图片列表的方法，不再使用估算值。

### V1.1.1

1. 修改了代码逻辑：将图片链接添加到下载列表前判断file_url键是否存在。

### V1.1.0

1. 添加了在线更新功能。
2. 修改了帮助信息。

### V1.0.3

1. 添加了错误处理。
2. 修改了下载器判断下载任务完成的逻辑，减少卡死几率。

### V1.0.1

1. 添加了版权信息。

### V1.0.0

1. 正式版上线。
